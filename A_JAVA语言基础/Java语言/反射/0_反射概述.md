# 反射概述



### 类加载器

程序要使用某个类时，如果类还没有被加载，系统会通过加载、连接、初始化三步来实现类的初始化。

* 加载--将class文件读入内存，并创建其Class对象

* 连接

  * 验证--检查内部结构是否正确，且与其它类协调一致
  * 准备--为类的静态成员分配内存，并设置默认初始化
  * 解析--将类的二进制数据中的符号引用替换为直接引用

* 初始化

  初始化的时机有：

  * 创建类的实例
  * 访问类的静态变量
  * 调用类的静态方法
  * 初始化该类的子类时，优先初始化该类
  * 利用反射创建类或接口的class对象
  * 直接使用java.exe运行某个类

##### 类加载器的分类

* 根类加载器--BootStrap-负责核心类加载
* 扩展类加载器--ExtClassLoader-负责JAVA扩展目录中的jar包加载
* 系统类加载器--AppClassLoader-负责开发者自己的类及依赖jar包的加载
* 自定义加载器--通过继承ClassLoader实现，常用于加密编译，以防止反编译工具编译出源代码，而使用自定义加载器解密。



### 反射

运行状态中，对于任意一个类，都能知道这个类的所有属性和方法；对于任意一个对象，都能调用它的任意一个属性和方法。相当变态的功能。

* 注意：

  在反射方法时，如果方法的参数是一个数组，考虑到向下兼容问题，会按照1.4的语法对待，JVM将之拆分，拆开后参数个数就不匹配了。解决方式为防止JVM将之拆分：

  * 方式一、将数组看做为Object对象，强转；
  * 方式二、new一个Object数组，将要传入的数组作为新数组的唯一元素。

* 反射示例：
  * 演示了获取Class、构造方法Constructor、成员变量Field、成员方法Method：top.trial.reflect.ReflectDemo
  * 演示了获取注解信息：

