# 微服务



### 一、背景之架构演进

* 传统单体架构是将多个功能模块集成在一起，打成jar包或war包来部署
  * 优点是开发简单 ，功能集中，模块间不产生额外通讯开销
  * 缺点是复杂性随需求增多而增高，扩展能力差，稳定性差，部署不灵活
* SOA架构是将服务粗粒度拆分，服务间松耦合，每个服务独立运行，服务间使用特定接口通讯
  * 优点是相比于单体架构，可重用可维护性提高，扩展能力增强
  * 缺点是系统与服务界限模糊，依赖ESB，系统与服务耦合性高，开发复杂度增大
* 微服务架构是在SOA基础上，去中心化去ESB，服务拆分粒度更细，侧重于业务的拆分
  * 优点是便于弹性扩展，兼容各种技术栈，开发复杂度相比SOA降低，耦合度更低

### 二、微服务基本理论

系统架构的一种设计风格，主旨是将原本独立的系统拆分成数个小型服务，它们在独立的进程中运行，服务采用RESTful API进行通信协作。这些小型服务围绕系统某一项或一些耦合度高的业务功能构建，拥有完整的数据存储、业务并发、自动化测试案例及独立部署机制。

由于采用RESTful API进行通信，因此可以采用不同语言进行编写。

因此，微服务有以下特点：**微而专注**【可以专注于单项功能的优化】，**全而自治**【独立实体，独立修改部署】，**高适应性**支持异构弹性扩展。

### 三、微服务面临的挑战

* 架构方面
  * 服务管理：生命周期，状态同步
  * 服务治理：通过动态配置实现限流熔断降级，路由负载
  * 服务配置：服务配置实时管理与同步
  * 问题定位：如何快速通过日志定位和分析问题
  * 服务监控：多主机状态监控、系统安全性监控
  * 服务运维：多团队交付运维协作
* 开发方面
  * 服务增多，服务间调用紧密，系统容错机制如何设计，降低因调用异常而产生的问题
  * 网络延迟异常的重试
  * 数据一致性【二阶段三阶段提交】
  * 关联查询涉及多数据库

### 四、微服务架构

* 注册发现：所有微服务内部通过Eureka实现自注册和自发现；
* 网关：外部请求反向路由到内部微服务，通过Spring Zuul实现，负责横跨切面功能，反向路由、安全、限流熔断和日志监控；
* 认证服务：使用Spring OAUTH2实现统一认证，访问控制、认证管理，保证微服务无状态化；
* 配置中心：统一管理微服务配置，提供配置同步等功能，通过Apollo实现；
* 管控平台：服务治理，平台监控报警，日志查看；
* 聚合服务：将微服务进行聚合裁剪加工后暴露到前端设备；
* 服务间限流熔断：服务间调用依赖容错组件Hystrix的保护下，实现自动化限制、熔断、隔离、降级

### 五、常见微服务架构

* SpringCloud
* SOFAStack
* ServiceComb
* Dubbo